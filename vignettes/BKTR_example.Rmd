---
title: "BIXI Regression Example"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{BIXI Regression Example}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(BKTR)
```


## Create a BKTR config
The BKTRConfig Object contains all the hyperparameters and configuration necessary to do a BKTR regression.
Feel free to change the default values of the configuration and to consult the BKTR manual for more information.
```{r}
ex_bktr_config <- BKTR::BKTRConfig$new(
  rank_decomp = 10,
  burn_in_iter = 1,
  max_iter = 2
)
```

## Create a BKTR config
The BKTRRegressor creates a regressor object using an already initialized configuration and a set of datasets in the form of matrices.
The set of datasets contained the following data:
- y: The reponse variable
- omega: A boolean mask matrix indicating missing data
- Temporal Covariates: The features that characterize the temporal data
- Spatial Covariates: The features that characterize the spatial data
- Spatial Distances: The distance matrix between each spatial entity
In this example we use the preloaded BIXI data (See the `data_loading_BIXI` vignette for more information)
```{r}
# Data coming from the BKTR package datasets
ex_bktr_regressor <- BKTR::BKTRRegressor$new(
    bktr_config = ex_bktr_config,
    temporal_covariate_mat = bixi_weather_matrix,
    spatial_covariate_mat = bixi_station_matrix,
    spatial_distance_mat = bixi_distance_matrix,
    y = bixi_y,
    omega = bixi_omega
)
```

## Run the MCMC Sampling
The following method of the regressor runs the MCMC sampling and returns the important data about the BKTR regression.
```{r}
bktr_estimates <- ex_bktr_regressor$mcmc_sampling()
print(bktr_estimates)
```